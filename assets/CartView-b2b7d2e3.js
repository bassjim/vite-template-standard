import{S as E}from"./sweetalert2.all-1b0220ca.js";import{_ as $,r as g,o as i,c as m,b as a,w as C,a as e,n as p,F as V,f as y,g as x,t as u,e as I,j as T,v as k}from"./index-d761a16c.js";const{VITE_URL:U,VITE_PATH:L}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"bassjim",BASE_URL:"/vite-template-standard/",MODE:"production",DEV:!1,PROD:!0},w={data(){return{cartItems:[],form:{user:{name:"",email:"",tel:"",address:""},message:""}}},methods:{isPhone(t){return/^(09)[0-9]{8}$/.test(t)?!0:"需要正確的電話號碼"},createOrder(){this.$http.post(`${U}/api/${L}/order`,{data:this.form}).then(t=>{alert(t.data.message),this.getCart(),this.$refs.form.resetForm(),this.cartItems=[]}).catch(t=>{console.log(t)})}},props:["getCart","cart"]},O={class:"my-5 row justify-content-center"},P={class:"mb-3"},R=e("label",{for:"email",class:"form-label"},"Email",-1),q={class:"mb-3"},D=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),S={class:"mb-3"},A=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),F={class:"mb-3"},N=e("label",{for:"address",class:"form-label"},"收件人地址",-1),B={class:"mb-3"},H=e("label",{for:"message",class:"form-label"},"留言",-1),j=e("textarea",{id:"message",class:"form-control",cols:"30",rows:"10"},null,-1),M=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1);function z(t,o,v,_,s,d){const c=g("v-field"),l=g("error-message"),n=g("v-form");return i(),m("div",O,[a(n,{ref:"form",class:"col-md-6",onSubmit:d.createOrder},{default:C(({errors:h})=>[e("div",P,[R,a(c,{id:"email",name:"email",type:"email",class:p(["form-control",{"is-invalid":h.email}]),placeholder:"請輸入 Email",rules:"required|email",modelValue:s.form.user.email,"onUpdate:modelValue":o[0]||(o[0]=r=>s.form.user.email=r)},null,8,["class","modelValue"]),a(l,{name:"email",class:"invalid-feedback"})]),e("div",q,[D,a(c,{id:"name",name:"姓名",type:"text",class:p(["form-control",{"is-invalid":h.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:s.form.user.name,"onUpdate:modelValue":o[1]||(o[1]=r=>s.form.user.name=r)},null,8,["class","modelValue"]),a(l,{name:"姓名",class:"invalid-feedback"})]),e("div",S,[A,a(c,{id:"tel",name:"電話",type:"tel",class:p(["form-control",{"is-invalid":h.電話}]),placeholder:"請輸入電話",rules:d.isPhone,modelValue:s.form.user.tel,"onUpdate:modelValue":o[2]||(o[2]=r=>s.form.user.tel=r)},null,8,["class","rules","modelValue"]),a(l,{name:"電話",class:"invalid-feedback"})]),e("div",F,[N,a(c,{id:"address",name:"地址",type:"text",class:p(["form-control",{"is-invalid":h.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:s.form.user.address,"onUpdate:modelValue":o[3]||(o[3]=r=>s.form.user.address=r)},null,8,["class","modelValue"]),a(l,{name:"地址",class:"invalid-feedback"})]),e("div",B,[H,a(c,{id:"message",name:"附註",type:"text",class:p(["form-control",{"is-invalid":h.附註}]),placeholder:"請輸入 附註",modelValue:s.form.message,"onUpdate:modelValue":o[4]||(o[4]=r=>s.form.message=r),as:"textarea",cols:"10",rows:"10"},{default:C(()=>[j]),_:2},1032,["class","modelValue"])]),M]),_:1},8,["onSubmit"])])}const G=$(w,[["render",z]]),{VITE_URL:f,VITE_PATH:b}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"bassjim",BASE_URL:"/vite-template-standard/",MODE:"production",DEV:!1,PROD:!0},J={data(){return{products:[],itemId:"",product:{},cart:{},loadingItem:""}},methods:{getCarts(){this.$http.get(`${f}/api/${b}/cart`).then(t=>{this.cart=t.data.data}).catch(t=>{console.log(t)})},updateCartItem(t){const o={product_id:t.product.id,qty:t.qty};this.loadingItem=t.id;const v=`${f}/api/${b}/cart/${t.id}`;this.$http.put(`${v}`,{data:o}).then(_=>{this.cart=_.data.data,this.getCarts(),this.loadingItem=""}).catch(_=>{console.log(_)})},deleteItem(t){this.loadingItem=t,this.$http.delete(`${f}/api/${b}/cart/${t}`).then(o=>{this.getCarts(),this.isLoading=!0,setTimeout(()=>{this.isLoading=!1},300)}).catch(o=>{console.log(o)})},clearCart(){this.$http.delete(`${f}/api/${b}/carts`).then(t=>{E.fire({title:"購物車目前沒有商品",icon:"question"}),this.getCarts(),this.loadingItem=""}).catch(t=>{console.log(t)})}},mounted(){this.getCarts(),this.$showLoading()},components:{OrderForm:G}},K={class:"text-end"},Q=e("h3",{class:"mt-5 mb-3 text-center"},"購物車",-1),W={class:"table align-middle"},X=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價")])],-1),Y=["disabled","onClick"],Z={key:0,class:"fas fa-spinner fa-pulse"},ee=e("div",{class:"text-success"}," 已套用優惠券 ",-1),te={class:"input-group input-group-sm"},se=["onUpdate:modelValue","disabled","onChange"],oe=["value"],le={class:"input-group-text",id:"basic-addon2"},ae={class:"text-end"},ne=e("small",{class:"text-success"},"折扣價：",-1),re=e("td",{colspan:"3",class:"text-end"},"總計",-1),de={class:"text-end"},ce={key:0},ie=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),me={class:"text-end text-success"};function ue(t,o,v,_,s,d){const c=g("OrderForm");return i(),m(V,null,[e("div",K,[e("button",{class:"btn btn-outline-danger",type:"button",onClick:o[0]||(o[0]=(...l)=>d.clearCart&&d.clearCart(...l))},"清空購物車")]),Q,e("table",W,[X,e("tbody",null,[s.cart.carts?(i(!0),m(V,{key:0},y(s.cart.carts,l=>(i(),m("tr",{key:l.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:l.id===s.loadingItem,onClick:n=>d.deleteItem(l.id)},[t.isLoading?(i(),m("i",Z)):x("",!0),I(" x ")],8,Y)]),e("td",null,[I(u(l.product.title)+" ",1),ee]),e("td",null,[e("div",te,[T(e("select",{class:"form-select","onUpdate:modelValue":n=>l.qty=n,disabled:l.id===s.loadingItem,onChange:n=>d.updateCartItem(l)},[(i(),m(V,null,y(20,n=>e("option",{value:n,key:n+"123456"},u(n),9,oe)),64))],40,se),[[k,l.qty]]),e("span",le,u(l.product.unit),1)])]),e("td",ae,[ne,I(" "+u(l.total),1)])]))),128)):x("",!0)]),e("tfoot",null,[e("tr",null,[re,e("td",de,u(s.cart.total),1)]),s.cart.final_total!==s.cart.total?(i(),m("tr",ce,[ie,e("td",me,u(s.cart.final_total),1)])):x("",!0)])]),a(c,{cart:s.cart,"get-cart":d.getCarts},null,8,["cart","get-cart"])],64)}const pe=$(J,[["render",ue]]);export{pe as default};
