import{S as r}from"./sweetalert2.all-1b0220ca.js";import{M as $,P as k,D as V}from"./DelModal-664ebc2b.js";import{_ as v,r as c,o as a,c as l,b as h,a as e,j as u,l as m,m as x,F as g,f as D,t as C}from"./index-d761a16c.js";const T={props:["tempCoupon","operateType"],emits:["saveCoupon"],data(){return{isLoading:!1,couponModal:"",due_date:"",innerCoupon:{}}},methods:{showModal(){this.couponModal.show()},hideModal(){this.couponModal.hide()}},mounted(){this.couponModal=new $(this.$refs.couponModal,{keyboard:!1})},watch:{tempCoupon(){this.innerCoupon=this.tempCoupon;const t=new Date(this.innerCoupon.due_date*1e3).toISOString().split("T");Array.isArray(t)&&([this.due_date]=t)},due_date(){this.innerCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}}},B={id:"couponModal",ref:"couponModal",class:"modal fade",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},P={class:"modal-dialog"},E={class:"modal-content border-0"},S={class:"modal-header bg-dark text-white"},U={id:"couponModalLabel",class:"modal-title"},I={key:0},A={key:1},N=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),R={class:"modal-body"},O={class:"mb-3"},j=e("label",{for:"title"},"標題",-1),F={class:"mb-3"},H=e("label",{for:"code"},"優惠碼",-1),q={class:"mb-3"},z=e("label",{for:"due_date"},"到期日",-1),G={class:"mb-3"},J=e("label",{for:"price"},"折扣百分比",-1),K={class:"mb-3"},Q={class:"form-check"},W=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),X={class:"modal-footer"},Y=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Z(t,o,p,M,n,d){const b=c("VueLoading");return a(),l(g,null,[h(b,{active:n.isLoading},null,8,["active"]),e("div",B,[e("div",P,[e("div",E,[e("div",S,[e("h5",U,[p.operateType==="create"?(a(),l("span",I,"新增優惠卷")):(a(),l("span",A,"編輯優惠卷"))]),N]),e("div",R,[e("div",O,[j,u(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":o[0]||(o[0]=s=>n.innerCoupon.title=s),placeholder:"請輸入標題"},null,512),[[m,n.innerCoupon.title]])]),e("div",F,[H,u(e("input",{type:"text",class:"form-control",id:"code","onUpdate:modelValue":o[1]||(o[1]=s=>n.innerCoupon.code=s),placeholder:"請輸入優惠碼"},null,512),[[m,n.innerCoupon.code]])]),e("div",q,[z,u(e("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":o[2]||(o[2]=s=>n.due_date=s)},null,512),[[m,n.due_date]])]),e("div",G,[J,u(e("input",{type:"number",class:"form-control",id:"price",min:"0",max:"100","onUpdate:modelValue":o[3]||(o[3]=s=>n.innerCoupon.percent=s),placeholder:"請輸入折扣百分比"},null,512),[[m,n.innerCoupon.percent,void 0,{number:!0}]])]),e("div",K,[e("div",Q,[u(e("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":o[4]||(o[4]=s=>n.innerCoupon.is_enabled=s),id:"is_enabled"},null,512),[[x,n.innerCoupon.is_enabled]]),W])])]),e("div",X,[Y,e("button",{type:"button",class:"btn btn-primary",onClick:o[5]||(o[5]=s=>t.$emit("saveCoupon",n.innerCoupon))}," 確認 ")])])])],512)],64)}const ee=v(T,[["render",Z]]),{VITE_URL:_,VITE_PATH:f}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"bassjim",BASE_URL:"/vite-template-standard/",MODE:"production",DEV:!1,PROD:!0},oe={data(){return{isLoading:!1,coupons:[],operateType:"",tempCoupon:{},pagination:{},pageNum:1}},methods:{getCoupons(t=1){this.isLoading=!0,this.pageNum=t,this.$http.get(`${_}/api/${f}/admin/coupons?page=${t}`).then(o=>{this.coupons=o.data.coupons,this.pagination=o.data.pagination,this.isLoading=!1}).catch(o=>{r.fire({icon:"error",title:o.response.data.message,showConfirmButton:!1,timer:1500}),this.isLoading=!1})},saveCoupon(t){this.isLoading=!0;let o=`${_}/api/${f}/admin/coupon`;this.operateType==="modify"&&(o=`${_}/api/${f}/admin/coupon/${t.id}`),this.$http[this.operateType==="create"?"post":"put"](`${o}`,{data:t}).then(p=>{this.$refs.couponModal.hideModal(),r.fire({icon:"success",title:p.data.message,showConfirmButton:!1,timer:1500}),this.getCoupons(this.pageNum),this.isLoading=!1}).catch(p=>{r.fire({icon:"error",title:p.response.data.message,showConfirmButton:!1,timer:1500}),this.isLoading=!1})},deleteCoupon(){this.isLoading=!0,this.$http.delete(`${_}/api/${f}/admin/coupon/${this.tempCoupon.id}`,{data:this.tempCoupon}).then(t=>{this.$refs.delModal.hideModal(),r.fire({icon:"success",title:t.data.message,showConfirmButton:!1,timer:1500}),this.getCoupons(this.pageNum),this.isLoading=!1}).catch(t=>{r.fire({icon:"error",title:t.response.data.message,showConfirmButton:!1,timer:1500}),this.isLoading=!1})},openModal(t,o){this.operateType=t,t==="create"?(this.tempCoupon={due_date:new Date().getTime()/1e3},this.$refs.couponModal.showModal()):t==="modify"?(this.tempCoupon={...o},this.$refs.couponModal.showModal()):t==="delete"&&(this.tempCoupon={...o},this.$refs.delModal.showModal())}},components:{PaginationComponent:k,CouponModal:ee,DelModal:V},mounted(){this.getCoupons(),this.$showLoading()}},te={class:"container"},ne={class:"text-end mt-4"},se={class:"table table-hover mt-4"},ie=e("thead",null,[e("tr",null,[e("th",{width:"120"},"名稱"),e("th",null,"折扣百分比"),e("th",{width:"120"}," 到期日 "),e("th",{width:"120"}," 是否啟用 "),e("th",{width:"120"}," 編輯 ")])],-1),ae={key:0,class:"text-success"},le={key:1},de={class:"btn-group"},pe=["onClick"],re=["onClick"];function ue(t,o,p,M,n,d){const b=c("VueLoading"),s=c("PaginationComponent"),y=c("CouponModal"),w=c("DelModal");return a(),l(g,null,[h(b,{active:n.isLoading},null,8,["active"]),e("div",te,[e("div",ne,[e("button",{class:"btn btn-primary",onClick:o[0]||(o[0]=i=>d.openModal("create"))}," 建立新的優惠券 ")]),e("table",se,[ie,e("tbody",null,[(a(!0),l(g,null,D(n.coupons,i=>(a(),l("tr",{key:i.id},[e("td",null,C(i.title),1),e("td",null,C(`${i.percent} %`),1),e("td",null,C(i.due_date),1),e("td",null,[i.is_enabled?(a(),l("span",ae,"啟用")):(a(),l("span",le,"未啟用"))]),e("td",null,[e("div",de,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:L=>d.openModal("modify",i)}," 編輯 ",8,pe),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:L=>d.openModal("delete",i)}," 刪除 ",8,re)])])]))),128))])]),h(s,{pagination:n.pagination,onChangePage:d.getCoupons},null,8,["pagination","onChangePage"])]),h(y,{ref:"couponModal","temp-coupon":n.tempCoupon,"operate-type":n.operateType,onSaveCoupon:d.saveCoupon},null,8,["temp-coupon","operate-type","onSaveCoupon"]),h(w,{ref:"delModal","temp-item":n.tempCoupon,onDeleteItem:d.deleteCoupon},null,8,["temp-item","onDeleteItem"])],64)}const _e=v(oe,[["render",ue]]);export{_e as default};
